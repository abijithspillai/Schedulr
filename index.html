<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCFS Scheduling Simulator</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #475569;
            --bg: #f8fafc;
            --idle: #94a3b8;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: #1e293b;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 30px;
        }

        /* Input Section */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: flex-end;
            justify-content: center;
            flex-wrap: wrap;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--secondary);
        }

        input {
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            width: 100px;
        }

        button {
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #1d4ed8;
        }

        button.reset {
            background-color: #ef4444;
        }

        button.reset:hover {
            background-color: #dc2626;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background-color: #f1f5f9;
            color: var(--secondary);
            font-weight: 600;
        }

        /* Gantt Chart Styles */
        .gantt-wrapper {
            margin-top: 40px;
            padding: 20px 0 40px 0; /* Extra bottom padding for labels */
            overflow-x: auto;
        }

        .gantt-chart {
            display: flex;
            height: 50px;
            min-width: 100%;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            overflow: visible; /* Allows labels to hang outside */
            position: relative;
            background: #f1f5f9;
        }

        .gantt-block {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            position: relative;
            box-sizing: border-box;
            border-right: 1px solid white;
            transition: filter 0.2s;
        }

        .gantt-block:last-child {
            border-right: none;
        }

        .gantt-block:hover {
            filter: brightness(1.1);
        }

        .gantt-block.idle {
            background-color: var(--idle);
            color: #f1f5f9;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
        }

        /* TIME AXIS LABELS */
        .time-marker {
            position: absolute;
            bottom: -28px; /* Position below the bar */
            left: 0;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 5;
        }

        .tick {
            width: 1px;
            height: 8px;
            background-color: #64748b;
            margin-bottom: 2px;
        }

        .time-val {
            font-size: 0.75rem;
            font-weight: bold;
            color: #475569;
        }

        /* Tooltip */
        .tooltip {
            visibility: hidden;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }

        .gantt-block:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        /* Stats Cards */
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            padding: 15px 25px;
            border-radius: 8px;
            text-align: center;
            min-width: 150px;
        }

        .stat-card h3 {
            margin: 0;
            font-size: 2rem;
            color: var(--primary);
        }

        .stat-card p {
            margin: 5px 0 0;
            color: var(--secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>FCFS Scheduling</h1>

    <div class="input-group">
        <div class="input-field">
            <label>Arrival Time</label>
            <input type="number" id="arrivalTime" placeholder="0" min="0">
        </div>
        <div class="input-field">
            <label>Burst Time</label>
            <input type="number" id="burstTime" placeholder="5" min="1">
        </div>
        <button onclick="addProcess()">Add Process</button>
        <button class="reset" onclick="resetData()">Reset</button>
    </div>

    <table id="processTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Arrival</th>
                <th>Burst</th>
                <th>Completion</th>
                <th>Turnaround</th>
                <th>Waiting</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <div style="text-align: center; margin-top: 20px;">
        <button onclick="calculateFCFS()" style="width: 200px; font-size: 1.1rem; padding: 12px;">Simulate</button>
    </div>

    <div id="results" style="display: none;">
        
        <div class="gantt-wrapper">
            <h3 style="text-align: center; color: var(--secondary); margin-bottom: 20px;">Gantt Chart</h3>
            <div class="gantt-chart" id="ganttChart"></div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="avgTurnaround">0.00</h3>
                <p>Avg Turnaround Time</p>
            </div>
            <div class="stat-card">
                <h3 id="avgWaiting">0.00</h3>
                <p>Avg Waiting Time</p>
            </div>
        </div>
    </div>
</div>

<script>
    let processes = [];
    let pidCounter = 1;
    const colors = ['#e11d48', '#d97706', '#059669', '#2563eb', '#7c3aed', '#db2777'];

    function addProcess() {
        const atInput = document.getElementById('arrivalTime');
        const btInput = document.getElementById('burstTime');
        const at = parseInt(atInput.value);
        const bt = parseInt(btInput.value);

        if (isNaN(at) || isNaN(bt) || at < 0 || bt <= 0) {
            alert("Please enter valid positive numbers.");
            return;
        }

        processes.push({
            id: 'P' + pidCounter,
            at: at,
            bt: bt,
            color: colors[(pidCounter - 1) % colors.length]
        });
        pidCounter++;
        updateTable();
        
        atInput.value = '';
        btInput.value = '';
        atInput.focus();
    }

    function updateTable() {
        const tbody = document.querySelector('#processTable tbody');
        tbody.innerHTML = '';
        processes.forEach(p => {
            tbody.innerHTML += `<tr>
                <td>${p.id}</td>
                <td>${p.at}</td>
                <td>${p.bt}</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>`;
        });
    }

    function resetData() {
        processes = [];
        pidCounter = 1;
        updateTable();
        document.getElementById('results').style.display = 'none';
    }

    function calculateFCFS() {
        if (processes.length === 0) {
            alert("Add processes first!");
            return;
        }

        // FCFS logic: Sort by Arrival Time
        let sortedProcesses = [...processes].sort((a, b) => a.at - b.at);
        let currentTime = 0;
        let totalTat = 0;
        let totalWt = 0;
        let ganttData = [];

        sortedProcesses.forEach(p => {
            // Check for Idle time
            if (currentTime < p.at) {
                ganttData.push({ type: 'idle', start: currentTime, end: p.at, duration: p.at - currentTime });
                currentTime = p.at;
            }

            const start = currentTime;
            const end = start + p.bt;
            
            p.ct = end;
            p.tat = end - p.at;
            p.wt = p.tat - p.bt;

            totalTat += p.tat;
            totalWt += p.wt;
            currentTime = end;

            ganttData.push({
                type: 'process',
                id: p.id,
                start: start,
                end: end,
                duration: p.bt,
                color: p.color,
                // store calculated values for tooltip
                stats: `WT: ${p.wt}, TAT: ${p.tat}`
            });
        });

        // Update Table
        const tbody = document.querySelector('#processTable tbody');
        tbody.innerHTML = '';
        sortedProcesses.forEach(p => {
            tbody.innerHTML += `<tr>
                <td>${p.id}</td>
                <td>${p.at}</td>
                <td>${p.bt}</td>
                <td>${p.ct}</td>
                <td>${p.tat}</td>
                <td>${p.wt}</td>
            </tr>`;
        });

        document.getElementById('avgTurnaround').innerText = (totalTat / processes.length).toFixed(2);
        document.getElementById('avgWaiting').innerText = (totalWt / processes.length).toFixed(2);
        
        renderGanttChart(ganttData);
        document.getElementById('results').style.display = 'block';
    }

    function renderGanttChart(data) {
        const chart = document.getElementById('ganttChart');
        chart.innerHTML = '';

        data.forEach((block, index) => {
            const div = document.createElement('div');
            div.classList.add('gantt-block');
            div.style.flexGrow = block.duration;
            div.style.flexBasis = '0'; // ensures proportionality
            
            if (block.type === 'idle') {
                div.classList.add('idle');
                div.innerText = 'Idle';
            } else {
                div.style.backgroundColor = block.color;
                div.innerText = block.id;
                div.innerHTML += `<span class="tooltip">${block.id}<br>Time: ${block.start} - ${block.end}<br>${block.stats}</span>`;
            }

            // Create Time Marker for the START of the block
            const startMarker = document.createElement('div');
            startMarker.className = 'time-marker';
            startMarker.style.left = '0'; // Align to left edge
            startMarker.innerHTML = `<div class="tick"></div><span class="time-val">${block.start}</span>`;
            div.appendChild(startMarker);

            // If it's the LAST block, we also need the END marker
            if (index === data.length - 1) {
                const endMarker = document.createElement('div');
                endMarker.className = 'time-marker';
                endMarker.style.left = '100%'; // Align to right edge
                endMarker.innerHTML = `<div class="tick"></div><span class="time-val">${block.end}</span>`;
                div.appendChild(endMarker);
            }

            chart.appendChild(div);
        });
    }
</script>

</body>
</html>